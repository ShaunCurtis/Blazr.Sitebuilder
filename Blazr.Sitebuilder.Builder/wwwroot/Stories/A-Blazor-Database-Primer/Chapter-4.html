<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<base href="/">

	

	

	
	<link href="/assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

	
	<link href="/assets/css/sb-admin-2.css" rel="stylesheet" type="text/css">
	<link href="/assets/css/site.css" rel="stylesheet" type="text/css">

	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
	<link rel="stylesheet" href="/assets/css/article.css" type="text/css">

	
	<link rel="icon" href="/assets/images/favicon.png">

	<title>Chapter 4 - Setting up the Solution to Run</title>
        <meta property="author" content="Shaun Curtis" />
        <meta property="description" content="This chapter looks at how to structure the solution to run as a Blazor Server SPA." />
    <meta property="og:site_name" content="Cold Elm Coders" />
        <meta property="og:site" content="https://shauncurtis.github.io/" />
        <meta property="og:title" content="Chapter 4 - Setting up the Solution to Run" />
        <meta property="og:description" content="This chapter looks at how to structure the solution to run as a Blazor Server SPA." /></head>
<body><header class="navbar bg-dark p-2 text-large text-light"><section class="navbar-section  text-light"><a href="/" class="navbar-brand mr-2 text-large text-light p-2">Cold Elm Coders</a>
			<a href="/Posts" class="btn btn-link text-light">Posts</a>
			<a href="/Rants" class="btn btn-link text-light">Rants</a>
			<a href="/Articles" class="btn btn-link text-light">Articles</a>
			<a href="/Stories" class="btn btn-link text-light">Stories</a>
			<a href="/Tags" class="btn btn-link text-light">Tags</a></section></header>

	<div class="container-fluid"><div class="row"><div class="col-12 col-sm-3 col-lg-2 bg-light pt-2"><div class="article-info p-2"><div class="mb-2">Published: 13-Aug-2021</div>
                <div class="mb-2">Updated: 13-Aug-2021</div>
                <div class="mb-2">Author: Shaun Curtis</div></div>
    <h4 class="p-2">Table of Contents</h4>
<ul class="TOC" >
<li class="TOC-item TOC-item-0" >
<a class="TOC-link" href="#">Top</a>
<ul class="TOC TOC-0" >
<li class="TOC-item TOC-item-1" >
<ul class="TOC TOC-1" >
<li class="TOC-item TOC-item-2" >
<a class="TOC-link" href="#refactoring-the-solution">Refactoring the Solution</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
			
			<div class="col-12 col-sm-9 col-lg-10 p-2"><div class="pt-2 pb-2 border-bottom mb-4 text-primary"><h1>Chapter 4 - Setting up the Solution to Run</h1>
            <div><small>This chapter looks at how to structure the solution to run as a Blazor Server SPA.</small></div></div>
    <div class="mb-2"><h3>Document List</h3>
        <ul><li><a href="/Stories/A-Blazor-Database-Primer/Index.html">A Blazor Database Primer</a></li><li><a href="/Stories/A-Blazor-Database-Primer/Chapter-1.html">Chapter 1 - Project Design and Structure</a></li><li><a href="/Stories/A-Blazor-Database-Primer/Chapter-2.html">Chapter 2 - The Data Store and Data Classes</a></li><li><a href="/Stories/A-Blazor-Database-Primer/Chapter-3.html">Chapter 3 - The Business and Application Code</a></li><li><a href="/Stories/A-Blazor-Database-Primer/Chapter-4.html">Chapter 4 - Setting up the Solution to Run</a></li><li><a href="/Stories/A-Blazor-Database-Primer/Chapter-5.html">Chapter 5 - Adding a WASM SPA to the Solution</a></li><li><a href="/Stories/A-Blazor-Database-Primer/Chapter-6.html">Chapter 6 -  Rebuilding FetchData</a></li><li><a href="/Stories/A-Blazor-Database-Primer/Chapter-7.html">Chapter 7 - Adding Sorting and Paging to the List Form</a></li></ul></div>
    <p>At this point we're ready to re-build the projects and run the solution.</p>
<h2 id="refactoring-the-solution">Refactoring the Solution</h2>
<h3 id="blazr.primer.ui">Blazr.Primer.UI</h3>
<h3 id="app">App</h3>
<p>Update the <code>Router</code> line in <em>App.razor</em></p>
<pre><code class="language-html">&lt;Router AppAssembly=&quot;@typeof(App).Assembly&quot; PreferExactMatches=&quot;@true&quot;&gt;
  .....
&lt;/Router&gt;
</code></pre>
<p>This points the Router to use <code>App</code>'s Assembly as <code>AppAssembly</code> (where the router looks for classes with Route attributes).</p>
<h3 id="blazr.primer">Blazr.Primer</h3>
<p>Add a <code>ServiceCollectionExtensions</code> class.</p>
<pre><code class="language-csharp">// Directory Blazr.Primer/Extensions
using Blazr.Primer.Core;
using Blazr.Primer.Data;
using Microsoft.Extensions.DependencyInjection;

namespace Blazr.Primer.SPA
{
    public static class ServiceCollectionExtensions
    {
        public static IServiceCollection AddServerApplicationServices(this IServiceCollection services)
        {
            // In Memory Datastore Setup
            services.AddSingleton&lt;WeatherDataStore&gt;();
            services.AddSingleton&lt;IDataBroker, ServerDataBroker&gt;();
            AddCommonServices(services);
            return services;
        }

        private static void AddCommonServices(this IServiceCollection services)
        {
            services.AddScoped&lt;IDataConnector, DataConnector&gt;();
            services.AddScoped&lt;WeatherForecastViewService&gt;();
        }
    }
}

</code></pre>
<p>This extends <code>IServiceCollection</code> with some methods to setup the required services for the application.  It keeps all the application specific services in one place.  There are two methods.</p>
<h3 id="blazordb.web">BlazorDB.Web</h3>
<p>Update the <code>component</code> type in <em>_Host.cshtml</em>.</p>
<pre><code class="language-html">    &lt;component type=&quot;typeof(Blazr.Primer.UI.App)&quot; render-mode=&quot;ServerPrerendered&quot; /&gt;
</code></pre>
<p>Update the <code>ConfigureServices</code> method in <code>Startup</code> to include the <code>IServiceCollection</code> extension method we built in <em>BlazorDB</em>.</p>
<pre><code class="language-csharp">using Blazr.Primer.SPA;

.....

public void ConfigureServices(IServiceCollection services)
{
    services.AddRazorPages();
    services.AddServerSideBlazor();
    services.AddServerApplicationServices();
}
</code></pre>
<h3 id="blazordb.ui">BlazorDB.Ui</h3>
<p>Update <code>FetchData</code> in <em>Blazr.Primer.Ui/RouteViews</em>.</p>
<pre><code class="language-html">@page &quot;/fetchdata&quot;
@using Blazr.Primer.Core
@namespace Blazr.Primer.UI.RouteViews

&lt;h1&gt;Weather forecast&lt;/h1&gt;

&lt;p&gt;This component demonstrates fetching data from a service.&lt;/p&gt;

@if (!ViewService.HasRecords)
{
    &lt;p&gt;&lt;em&gt;Loading...&lt;/em&gt;&lt;/p&gt;
}
else
{
    &lt;table class=&quot;table&quot;&gt;
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;Date&lt;/th&gt;
                &lt;th&gt;Temp. (C)&lt;/th&gt;
                &lt;th&gt;Temp. (F)&lt;/th&gt;
                &lt;th&gt;Summary&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
            @foreach (var forecast in ViewService.Records)
            {
                &lt;tr&gt;
                    &lt;td&gt;@forecast.Date.ToShortDateString()&lt;/td&gt;
                    &lt;td&gt;@forecast.TemperatureC&lt;/td&gt;
                    &lt;td&gt;@forecast.TemperatureF&lt;/td&gt;
                    &lt;td&gt;@forecast.Summary&lt;/td&gt;
                &lt;/tr&gt;
            }
        &lt;/tbody&gt;
    &lt;/table&gt;
}

@code {
    [Inject] WeatherForecastViewService ViewService { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await ViewService.GetRecordsAsync();
    }
}
</code></pre>
<h3 id="build-the-solution">Build the Solution</h3>
<p>At this point you should be able to build and run the solution.</p>
</div></div></div></body></html>





